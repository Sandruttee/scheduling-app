<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Monthly Schedule</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="main-container">
      <h2>Your Monthly Schedule</h2>
      <p style="margin-bottom: 24px">
        Hello, <span id="staffName">[Staff Name]</span> ðŸ‘‹
      </p>

      <div style="margin-bottom: 20px">
        <label for="monthSelect">Select Month:</label>
        <select id="monthSelect">
          <option>May 2025</option>
          <option>June 2025</option>
          <option>July 2025</option>
        </select>
      </div>

      <table style="width: 100%; border-collapse: collapse">
        <thead>
          <tr>
            <th style="text-align: left; padding: 10px">Date</th>
            <th style="text-align: left; padding: 10px">Day</th>
            <th style="text-align: left; padding: 10px">Shift</th>
            <th style="text-align: left; padding: 10px">Category</th>
          </tr>
        </thead>
        <tbody id="scheduleTable">
          <tr>
            <td style="padding: 10px">2025-06-03</td>
            <td style="padding: 10px">Tuesday</td>
            <td style="padding: 10px">17:00 â€“ 22:00</td>
            <td style="padding: 10px">Kitchen</td>
          </tr>
          <tr>
            <td style="padding: 10px">2025-06-06</td>
            <td style="padding: 10px">Friday</td>
            <td style="padding: 10px">18:00 â€“ 23:00</td>
            <td style="padding: 10px">Bar</td>
          </tr>
          <tr>
            <td style="padding: 10px">2025-06-10</td>
            <td style="padding: 10px">Monday</td>
            <td style="padding: 10px">16:00 â€“ 21:00</td>
            <td style="padding: 10px">Service</td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      document.getElementById("staffName").textContent =
        localStorage.getItem("staffName") || "Staff";

      const AIRTABLE_TOKEN =
        "patc0yXmJjN3pxChz.b6c20343d5e39716a6e6de61782fba38e0f97f9b2c7464fd4d2a10c031b9abe2";
      const AIRTABLE_BASE_ID = "appQ24001pnPlpxeg";
      const SHIFTS_TABLE = "Shifts";
      const STAFF_ID = localStorage.getItem("staffId");

      const airtableURL = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(
        SHIFTS_TABLE
      )}?filterByFormula=({Staff} = '${STAFF_ID}')`;

      async function loadSchedule() {
        try {
          const res = await fetch(airtableURL, {
            headers: {
              Authorization: `Bearer ${AIRTABLE_TOKEN}`,
            },
          });

          const data = await res.json();

          if (res.ok && data.records.length > 0) {
            const table = document.getElementById("scheduleTable");
            table.innerHTML = "";

            data.records.forEach((record) => {
              const date = record.fields.Date;
              const day = new Date(date).toLocaleDateString("en-GB", {
                weekday: "long",
              });
              const time = record.fields.Time || "â€“";
              const role = record.fields.Role || "â€“";

              const row = `
            <tr>
              <td style="padding: 10px">${date}</td>
              <td style="padding: 10px">${day}</td>
              <td style="padding: 10px">${time}</td>
              <td style="padding: 10px">${role}</td>
            </tr>
          `;
              table.innerHTML += row;
            });
          } else {
            document.getElementById("scheduleTable").innerHTML =
              "<tr><td colspan='4' style='padding:10px'>No shifts found.</td></tr>";
          }
        } catch (err) {
          console.error("Schedule load failed:", err);
          document.getElementById("scheduleTable").innerHTML =
            "<tr><td colspan='4' style='padding:10px'>Error loading shifts.</td></tr>";
        }
      }

      loadSchedule();
    </script>
  </body>
</html>
